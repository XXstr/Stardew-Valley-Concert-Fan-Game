<!DOCTYPE html> 
<html lang="zh-CN"> 
<head> 
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<title>æ˜Ÿéœ²è°·ç‰©è¯­ï¼šæ’­ç§ä¸è§„åˆ’ (Emojiæ¨¡å¼å¼€å…³ç‰ˆ)</title> 
<style> 
        :root { 
            --stardew-brown: #8b5a2b; 
            --stardew-soil: #b88b5a; 
            --stardew-light-soil: #d4a777; 
            --stardew-bg: #f0e8d1; 
            --stardew-container-bg: #f7f2e4; 
            --stardew-text: #513a2c; 
            --stardew-green: #78a233; 
            --stardew-highlight: #fdeca6; 
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
            background-color: var(--stardew-bg); 
            color: var(--stardew-text); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            user-select: none; 
        }

        #game-container { 
            text-align: center; 
            background-color: var(--stardew-container-bg); 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); 
            border: 5px solid var(--stardew-brown); 
            margin: 20px 0; 
        }

        h1 { color: #6a4f4b; margin-top: 0; } 
        
        #instructions { 
            margin: -10px 0 15px 0; 
            padding: 8px; 
            background-color: var(--stardew-bg); 
            border-radius: 5px; 
            border: 1px dashed var(--stardew-brown); 
            min-height: 40px; 
        }
        
        #instructions strong { color: var(--stardew-green); } 

        #status-bar { 
            display: flex; 
            justify-content: space-around; 
            margin: 15px 0; 
            font-size: 1.2em; 
            font-weight: bold; 
        }
        
        #conveyor-belt-container { 
            background-color: #c4a782; 
            padding: 10px; 
            border-radius: 10px; 
            margin: 0 auto 20px auto; 
            border: 2px solid var(--stardew-brown); 
            display: grid; 
            grid-template-rows: repeat(2, 35px); 
            grid-template-columns: repeat(8, 35px); 
            gap: 5px; 
            align-items: center; 
            justify-content: center; 
            width: fit-content; 
        }
        
        #conveyor-belt { 
            display: contents; 
        }

        .seed-packet { 
            width: 30px; 
            height: 30px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            border-radius: 5px; 
            background-color: #eaddc7; 
            border: 2px solid var(--stardew-brown); 
            cursor: pointer; 
            transition: all 0.2s; 
            flex-shrink: 0; 
            font-size: 24px; 
        }
        .seed-packet.selected { 
            background-color: var(--stardew-highlight); 
            transform: scale(1.15); 
            box-shadow: 0 0 10px #ffbf00; 
        }

        #farm-grid { 
            display: grid; 
            grid-template-columns: repeat(6, 60px); 
            grid-template-rows: repeat(6, 60px); 
            gap: 4px; 
            background-color: var(--stardew-brown); 
            border: 4px solid var(--stardew-brown); 
            padding: 4px; 
            border-radius: 10px; 
            cursor: default; 
            margin-left: auto; 
            margin-right: auto; 
            touch-action: none; 
        }
        
        .harvesting-phase .cell.edge { cursor: pointer; } 

        .cell { 
            width: 60px; 
            height: 60px; 
            background-color: var(--stardew-soil); 
            border-radius: 5px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 36px; 
            position: relative; 
        }
        
        .cell.empty.planting-phase:hover { 
            cursor: pointer; 
            background-color: var(--stardew-light-soil); 
        }
        
        .cell.path { 
            background-color: var(--stardew-highlight) !important; 
            opacity: 0.8; 
        }

        .crop-container { 
            width: 100%; 
            height: 100%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            animation: plant-pop 0.3s ease-out; 
            pointer-events: none; 
        }
        .crop-container.mature { 
            transform: scale(1.1); 
            box-sizing: border-box; 
        }

        #game-over-overlay { 
            position: fixed; 
            top: 0; left: 0; width: 100%; height: 100%; 
            background-color: rgba(0, 0, 0, 0.7); 
            color: white; 
            display: none; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            font-size: 3em; 
            z-index: 100; 
        }
        
        #action-btn { 
            padding: 10px 20px; 
            font-size: 1.2em; 
            background-color: var(--stardew-green); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin-top: 15px; 
            transition: background-color 0.2s; 
            width: 200px; 
        }
        #action-btn:disabled { background-color: #a0a0a0; cursor: not-allowed; } 
        #action-btn:hover:not(:disabled) { background-color: #8bc34a; } 
        
        .seed-packet img, .crop-container img { 
            max-width: 100%; 
            max-height: 100%; 
            object-fit: contain; 
            image-rendering: pixelated; 
            image-rendering: -moz-crisp-edges; 
            image-rendering: crisp-edges; 
        }
    </style> </head> <body> <div id="game-container">
        <h1>æ˜Ÿéœ²è°·ï¼šæ’­ç§ä¸è§„åˆ’</h1>
        <div id="instructions"></div>
        <div id="status-bar">
            <div id="day-counter">ç¬¬ 1 å¤©</div>
            <div id="seed-counter">ç§å­: 10/16</div>
        </div>
        <div id="conveyor-belt-container">
            <div id="conveyor-belt"></div>
        </div>
        <div id="farm-grid"></div>
        <button id="action-btn">å®Œæˆæ’­ç§</button>
    </div>
    
    <div id="game-over-overlay">
        <div>æ¸¸æˆå¤±è´¥</div>
        <button onclick="location.reload()" style="margin-top: 20px; font-size: 0.5em; padding: 10px 20px;">é‡æ–°å¼€å§‹</button>
    </div>

    <script> 
        const USE_EMOJI_MODE = false; 

        const GRID_SIZE = 6; 
        const MAX_SEEDS = 16; 
        const SEEDS_PER_DAY = 10; 
        
        const CROP_TYPES = [ 
            { 
                id: 'parsnip', 
                emoji: 'ğŸ¤', 
                img_seed: 'pic/Parsnip_Seeds.png', 
                img_stage_0: 'pic/Parsnip_Stage_1.png', 
                img_stage_1: 'pic/Parsnip_Stage_4.png', 
                img_mature: 'pic/Parsnip.png'          
            },
            { 
                id: 'potato', 
                emoji: 'ğŸ¥”', 
                img_seed: 'pic/Potato_Seeds.png', 
                img_stage_0: 'pic/Potato_Stage_1.png', 
                img_stage_1: 'pic/Potato_Stage_4.png', 
                img_mature: 'pic/Potato.png' 
            },
            { 
                id: 'cauliflower', 
                emoji: 'ğŸ¥¦', 
                img_seed: 'pic/Broccoli_Seeds.png', 
                img_stage_0: 'pic/Broccoli_Stage_1.png', 
                img_stage_1: 'pic/Broccoli_Stage_4.png', 
                img_mature: 'pic/Broccoli.png' 
            },
            { 
                id: 'pumpkin', 
                emoji: 'ğŸƒ', 
                img_seed: 'pic/Pumpkin_Seeds.png', 
                img_stage_0: 'pic/Pumpkin_Stage_1.png', 
                img_stage_1: 'pic/Pumpkin_Stage_4.png', 
                img_mature: 'pic/Pumpkin.png' 
            },
            { 
                id: 'strawberry', 
                emoji: 'ğŸ“', 
                img_seed: 'pic/Strawberry_Seeds.png', 
                img_stage_0: 'pic/Strawberry_Stage_1.png', 
                img_stage_1: 'pic/Strawberry_Stage_4.png', 
                img_mature: 'pic/Strawberry.png'         
            },
        ];

        let farmGrid = [], conveyorSeeds = [], currentDay = 1; 
        let gameState = { 
            phase: 'PLANTING', 
            selectedSeedIndex: null, 
            isPathing: false, 
            currentPath: [], 
        };

        const gridElement = document.getElementById('farm-grid'); 
        const conveyorElement = document.getElementById('conveyor-belt'); 
        const dayCounterElement = document.getElementById('day-counter'); 
        const seedCounterElement = document.getElementById('seed-counter'); 
        const actionBtn = document.getElementById('action-btn'); 
        const gameOverOverlay = document.getElementById('game-over-overlay'); 
        const instructionsElement = document.getElementById('instructions'); 

        function initGame() { 
            gridElement.innerHTML = ''; 
            for (let r = 0; r < GRID_SIZE; r++) { 
                farmGrid[r] = []; 
                for (let c = 0; c < GRID_SIZE; c++) { 
                    farmGrid[r][c] = null; 
                    const cell = document.createElement('div'); 
                    cell.classList.add('cell'); 
                    cell.dataset.row = r; 
                    cell.dataset.col = c; 
                    if (r === 0 || r === GRID_SIZE - 1 || c === 0 || c === GRID_SIZE - 1) { 
                        cell.classList.add('edge'); 
                    } else { 
                         cell.style.backgroundColor = 'var(--stardew-soil)'; 
                    }
                    gridElement.appendChild(cell); 
                }
            }
            addEventListeners(); 
            addNewSeeds(); 
            updatePhase('PLANTING'); 
        }
        
        function updatePhase(newPhase) { 
            gameState.phase = newPhase; 
            gameState.isPathing = false; 
            gameState.currentPath = []; 
            
            gridElement.className = 'farm-grid'; 
            gridElement.classList.add(newPhase.toLowerCase() + '-phase'); 
            
            if (newPhase === 'PLANTING') { 
                actionBtn.textContent = 'å®Œæˆæ’­ç§'; 
                actionBtn.disabled = false; 
                instructionsElement.innerHTML = "<strong>é˜¶æ®µä¸€ï¼šæ’­ç§</strong><br>ç‚¹å‡»ä¼ é€å¸¦é€‰æ‹©ç§å­ï¼Œå†ç‚¹å‡»å†œç”°ç©ºæ ¼å­ç§ä¸‹ã€‚"; 
            } else if (newPhase === 'HARVESTING') { 
                actionBtn.textContent = 'æ”¶è·è·¯å¾„'; 
                actionBtn.disabled = true; 
                instructionsElement.innerHTML = "<strong>é˜¶æ®µäºŒï¼šæ”¶è·</strong><br>åœ¨å†œç”°å¤–åœˆæŒ‰ä½å¹¶æ‹–åŠ¨ï¼Œç”»å‡ºæ”¶è·è·¯å¾„ã€‚"; 
            } else if (newPhase === 'DAY_END') { 
                actionBtn.textContent = 'å¼€å¯æ–°çš„ä¸€å¤©'; 
                actionBtn.disabled = false; 
                instructionsElement.innerHTML = "ä¸€å¤©ç»“æŸäº†ï¼ç‚¹å‡»æŒ‰é’®å¼€å§‹æ–°çš„ä¸€å¤©ã€‚"; 
            }
            updateUI(); 
        }

        function addNewSeeds() { 
            for (let i = 0; i < SEEDS_PER_DAY; i++) { 
                conveyorSeeds.push(CROP_TYPES[Math.floor(Math.random() * CROP_TYPES.length)]); 
            }
        }

        function updateUI() { 
            gridElement.childNodes.forEach((cell, index) => { 
                const r = Math.floor(index / GRID_SIZE); 
                const c = index % GRID_SIZE; 
                const crop = farmGrid[r][c]; 
                cell.innerHTML = ''; 
                cell.classList.remove('path'); 
                cell.classList.toggle('empty', crop === null); 

                if (gameState.currentPath.some(p => p.r === r && p.c === c)) { 
                    cell.classList.add('path'); 
                }

                if (crop) { 
                    const cropDiv = document.createElement('div'); 
                    cropDiv.classList.add('crop-container'); 
                    
                    if (USE_EMOJI_MODE) { 
                        cropDiv.textContent = crop.emoji; 
                    } else { 
                        const cropImg = document.createElement('img'); 
                        if (crop.daysToMature === 0) { 
                            cropImg.src = crop.img_mature; 
                        } else if (crop.daysToMature === 1) { 
                            cropImg.src = crop.img_stage_1; 
                        } else { 
                            cropImg.src = crop.img_stage_0; 
                        }
                        cropDiv.appendChild(cropImg); 
                    }
                    
                    if (crop.daysToMature === 0) { 
                         cropDiv.classList.add('mature'); 
                    }
                    cell.appendChild(cropDiv); 
                }
            });
            
            conveyorElement.innerHTML = ''; 
            conveyorSeeds.forEach((seed, index) => { 
                const seedPacket = document.createElement('div'); 
                seedPacket.classList.add('seed-packet'); 
                
                if (USE_EMOJI_MODE) { 
                    seedPacket.textContent = seed.emoji; 
                } else { 
                    const seedImg = document.createElement('img'); 
                    seedImg.src = seed.img_seed; 
                    seedPacket.appendChild(seedImg); 
                }

                seedPacket.dataset.index = index; 
                if (index === gameState.selectedSeedIndex) { 
                    seedPacket.classList.add('selected'); 
                }
                conveyorElement.appendChild(seedPacket); 
            });

            dayCounterElement.textContent = `ç¬¬ ${currentDay} å¤©`; 
            seedCounterElement.textContent = `ç§å­: ${conveyorSeeds.length}/${MAX_SEEDS}`; 
            seedCounterElement.style.color = conveyorSeeds.length > MAX_SEEDS ? 'red' : 'inherit'; 
        }
        
        function addEventListeners() { 
            conveyorElement.addEventListener('click', handleConveyorClick); 
            gridElement.addEventListener('click', handleGridClick); 
            
            gridElement.addEventListener('mousedown', startHarvestDraw); 
            gridElement.addEventListener('touchstart', startHarvestDraw, { passive: false }); 

            gridElement.addEventListener('mouseover', continueHarvestDraw); 
            gridElement.addEventListener('touchmove', continueHarvestDraw, { passive: false }); 

            document.addEventListener('mouseup', endHarvestDraw); 
            document.addEventListener('touchend', endHarvestDraw); 

            actionBtn.addEventListener('click', handleActionButton); 
        }

        function handleGridClick(e) { 
            if (gameState.phase !== 'PLANTING') return; 

            const cell = e.target.closest('.cell'); 
            if (!cell) return; 
            handlePlantingClick(cell); 
        }

        function handleConveyorClick(e) { 
            if (gameState.phase !== 'PLANTING') return; 
            const packet = e.target.closest('.seed-packet'); 
            if (!packet) return; 
            const index = parseInt(packet.dataset.index); 
            gameState.selectedSeedIndex = (gameState.selectedSeedIndex === index) ? null : index; 
            updateUI(); 
        }

        function handlePlantingClick(cell) { 
            if (gameState.selectedSeedIndex === null || !cell.classList.contains('empty')) return; 
            const r = parseInt(cell.dataset.row); 
            const c = parseInt(cell.dataset.col); 
            const seedToPlant = conveyorSeeds[gameState.selectedSeedIndex]; 
            farmGrid[r][c] = { ...seedToPlant, daysToMature: 2 }; 
            conveyorSeeds.splice(gameState.selectedSeedIndex, 1); 
            gameState.selectedSeedIndex = null; 
            updateUI(); 
        }

        function startHarvestDraw(e) { 
            if (gameState.phase !== 'HARVESTING') return; 
            
            e.preventDefault(); 

            const cell = e.target.closest('.cell'); 
            if (!cell || !cell.classList.contains('edge')) return; 
            
            gameState.isPathing = true; 
            const r = parseInt(cell.dataset.row); 
            const c = parseInt(cell.dataset.col); 
            gameState.currentPath = [{ r, c }]; 
            updateUI(); 
        }

        function continueHarvestDraw(e) { 
            if (!gameState.isPathing) return; 
            e.preventDefault(); 

            let targetCell = null; 

            if (e.touches && e.touches[0]) { 
                const touch = e.touches[0]; 
                const element = document.elementFromPoint(touch.clientX, touch.clientY); 
                if (element) { 
                    targetCell = element.closest('.cell'); 
                }
            } else { 
                targetCell = e.target.closest('.cell'); 
            }
            
            if (!targetCell) return; 
            
            const r = parseInt(targetCell.dataset.row); 
            const c = parseInt(targetCell.dataset.col); 

            const lastPos = gameState.currentPath[gameState.currentPath.length - 1]; 
            const isAdjacent = (Math.abs(r - lastPos.r) === 1 && c === lastPos.c) || (Math.abs(c - lastPos.c) === 1 && r === lastPos.r); 
            const isNotVisited = !gameState.currentPath.some(p => p.r === r && p.c === c); 

            if (isAdjacent && isNotVisited) { 
                gameState.currentPath.push({ r, c }); 
                updateUI(); 
            }
        }

        function endHarvestDraw(e) { 
            if (!gameState.isPathing) return; 
            gameState.isPathing = false; 

            if (gameState.currentPath.length > 0) { 
                finalizeHarvestPath(); 
            }
        }

        function handleActionButton() { 
            if (gameState.phase === 'PLANTING') { 
                updatePhase('HARVESTING'); 
            } else if (gameState.phase === 'DAY_END') { 
                startNewDay(); 
            }
        }

        function finalizeHarvestPath() { 
            harvestCropsByPath(gameState.currentPath); 
            setTimeout(() => { 
                updatePhase('DAY_END'); 
            }, 300);
        }

        function harvestCropsByPath(path) { 
            const toHarvest = new Set(); 
            if (path.length < 3) return; 
            let chain = []; 
            function checkChain() { 
                if (chain.length >= 3) { 
                    chain.forEach(pos => toHarvest.add(`${pos.r}-${pos.c}`)); 
                }
            }
            for (const pos of path) { 
                const crop = farmGrid[pos.r][pos.c]; 
                const chainCrop = chain.length > 0 ? farmGrid[chain[0].r][chain[0].c] : null; 
                if (crop && crop.daysToMature === 0 && (chain.length === 0 || crop.id === chainCrop.id)) { 
                    chain.push(pos); 
                } else { 
                    checkChain(); 
                    chain = (crop && crop.daysToMature === 0) ? [pos] : []; 
                }
            }
            checkChain(); 
            toHarvest.forEach(posString => { 
                const [r, c] = posString.split('-').map(Number); 
                farmGrid[r][c] = null; 
            });
        }

        function startNewDay() { 
            currentDay++; 
            for (let r = 0; r < GRID_SIZE; r++) { 
                for (let c = 0; c < GRID_SIZE; c++) { 
                    if (farmGrid[r][c] && farmGrid[r][c].daysToMature > 0) { 
                        farmGrid[r][c].daysToMature--; 
                    }
                }
            }
            addNewSeeds(); 
            if (conveyorSeeds.length > MAX_SEEDS) { 
                gameOver(); 
                return; 
            }
            updatePhase('PLANTING'); 
        }
        
        function gameOver() { 
            gameOverOverlay.style.display = 'flex'; 
        }

        initGame(); 
    </script> </body> </html>